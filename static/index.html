<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>üïπÔ∏è –ö–ª–∏–∫–µ—Ä</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;400&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', Arial, sans-serif;
            background: var(--bg, linear-gradient(135deg, #232526 0%, #414345 100%));
            color: #fff;
            min-height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            transition: background 0.5s;
        }
        h1 {
            margin-top: 32px;
            font-size: 2.5em;
            letter-spacing: 2px;
            text-shadow: 0 4px 24px #000a;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .score {
            font-size: 2.5em;
            margin: 30px 0 10px 0;
            font-weight: 700;
            text-shadow: 0 2px 12px #0008;
        }
        .main-btn {
            font-size: 2em;
            padding: 18px 60px;
            margin: 18px 0 30px 0;
            border: none;
            border-radius: 18px;
            background: var(--btn, linear-gradient(90deg, #43cea2 0%, #185a9d 100%));
            color: #fff;
            font-weight: 700;
            box-shadow: 0 6px 24px #185a9d55;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s, background 0.5s;
            position: relative;
            z-index: 2;
        }
        .main-btn:active {
            transform: scale(0.97);
            box-shadow: 0 2px 8px #185a9d33;
        }
        .main-btn.crit {
            animation: crit 0.4s;
            background: linear-gradient(90deg, #ff512f 0%, #dd2476 100%);
            box-shadow: 0 0 40px #ff512f99;
        }
        @keyframes crit {
            0% { transform: scale(1); }
            30% { transform: scale(1.2) rotate(-5deg); }
            60% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1); }
        }
        .main-btn.pulse {
            animation: pulse 0.3s;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 #43cea288; }
            100% { box-shadow: 0 0 0 20px #43cea200; }
        }
        .upgrades {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 18px;
            margin-bottom: 18px;
        }
        .upgrade-card {
            background: linear-gradient(120deg, #232526 60%, #43cea2 100%);
            border-radius: 16px;
            box-shadow: 0 2px 16px #0005;
            padding: 18px 22px;
            min-width: 140px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: box-shadow 0.2s;
        }
        .upgrade-card:hover {
            box-shadow: 0 6px 32px #43cea299;
        }
        .upgrade-title {
            font-size: 1.1em;
            font-weight: 700;
            margin-bottom: 6px;
        }
        .upgrade-count {
            font-size: 1.2em;
            margin-bottom: 8px;
        }
        .upgrade-btn {
            background: linear-gradient(90deg, #43cea2 0%, #185a9d 100%);
            color: #fff;
            border: none;
            border-radius: 10px;
            padding: 8px 22px;
            font-size: 1em;
            font-weight: 700;
            cursor: pointer;
            margin-top: 4px;
            box-shadow: 0 2px 8px #185a9d33;
            transition: background 0.2s, transform 0.1s;
        }
        .upgrade-btn:active {
            background: linear-gradient(90deg, #185a9d 0%, #43cea2 100%);
            transform: scale(0.97);
        }
        .boost-bar {
            width: 90vw;
            max-width: 400px;
            height: 18px;
            background: #222b;
            border-radius: 10px;
            margin: 18px auto 0 auto;
            overflow: hidden;
            box-shadow: 0 2px 8px #43cea288;
        }
        .boost-bar-inner {
            height: 100%;
            background: linear-gradient(90deg, #f7971e 0%, #ffd200 100%);
            transition: width 0.5s;
        }
        .info {
            margin: 18px 0 0 0;
            font-size: 1.1em;
            color: #b2f7ef;
            text-shadow: 0 1px 4px #0008;
        }
        .chest-btn {
            margin: 18px 0 0 0;
            font-size: 1.2em;
            padding: 12px 32px;
            border-radius: 12px;
            border: none;
            background: linear-gradient(90deg, #f7971e 0%, #ffd200 100%);
            color: #222;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 2px 12px #ffd20055;
            transition: background 0.2s;
        }
        .chest-btn:active {
            background: linear-gradient(90deg, #ffd200 0%, #f7971e 100%);
        }
        .daily-btn {
            margin: 18px 0 0 0;
            font-size: 1.1em;
            padding: 8px 24px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(90deg, #43cea2 0%, #185a9d 100%);
            color: #fff;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 2px 8px #185a9d33;
        }
        .daily-btn:active {
            background: linear-gradient(90deg, #185a9d 0%, #43cea2 100%);
        }
        .achievements {
            margin: 18px 0 0 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        .ach {
            background: #222b;
            color: #ffd200;
            border-radius: 8px;
            padding: 4px 12px;
            font-size: 1em;
            font-weight: 700;
            box-shadow: 0 1px 4px #ffd20044;
        }
        .theme-btns {
            margin: 18px 0 0 0;
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        .theme-btn {
            border: none;
            border-radius: 8px;
            padding: 6px 18px;
            font-size: 1em;
            font-weight: 700;
            cursor: pointer;
            background: #333;
            color: #fff;
            transition: background 0.2s;
        }
        .theme-btn.selected {
            background: #ffd200;
            color: #222;
        }
        .confetti {
            position: fixed;
            left: 0; top: 0; width: 100vw; height: 100vh;
            pointer-events: none;
            z-index: 9999;
        }
        @media (max-width: 600px) {
            .score { font-size: 2em; }
            .main-btn { font-size: 1.2em; padding: 12px 20px; }
            .upgrade-card { min-width: 110px; padding: 12px 8px; }
        }
    </style>
</head>
<body>
    <h1>üéÆ –ö–ª–∏–∫–µ—Ä</h1>
    <div class="score" id="score">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <button class="main-btn" id="clickBtn">–ö–ª–∏–∫!</button>
    <div class="upgrades">
        <div class="upgrade-card">
            <div class="upgrade-title">–ê–≤—Ç–æ-–∫–ª–∏–∫</div>
            <div class="upgrade-count" id="autoClickCount">0</div>
            <button class="upgrade-btn" id="autoClickBtn">–ö—É–ø–∏—Ç—å (100)</button>
        </div>
        <div class="upgrade-card">
            <div class="upgrade-title">–ú–Ω–æ–∂–∏—Ç–µ–ª—å</div>
            <div class="upgrade-count" id="multiplierCount">0</div>
            <button class="upgrade-btn" id="multiplierBtn">–ö—É–ø–∏—Ç—å (200)</button>
        </div>
        <div class="upgrade-card">
            <div class="upgrade-title">–ë—É—Å—Ç</div>
            <div class="upgrade-count" id="boostCount">0</div>
            <button class="upgrade-btn" id="boostBtn">–ö—É–ø–∏—Ç—å (300)</button>
        </div>
    </div>
    <div class="boost-bar" id="boostBar" style="display:none;">
        <div class="boost-bar-inner" id="boostBarInner" style="width:0%"></div>
    </div>
    <button class="chest-btn" id="chestBtn" style="display:none;">–û—Ç–∫—Ä—ã—Ç—å —Å—É–Ω–¥—É–∫ üéÅ</button>
    <button class="daily-btn" id="dailyBtn">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å</button>
    <div class="info" id="info"></div>
    <div class="achievements" id="achievements"></div>
    <div class="theme-btns" id="themeBtns"></div>
    <canvas class="confetti" id="confetti" style="display:none;"></canvas>
    <script>
        let user_id = null;
        if (window.Telegram && Telegram.WebApp && Telegram.WebApp.initDataUnsafe && Telegram.WebApp.initDataUnsafe.user) {
            user_id = Telegram.WebApp.initDataUnsafe.user.id;
        } else {
            user_id = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à user_id (–¥–ª—è —Ç–µ—Å—Ç–∞):');
        }
        let lastScore = 0;
        async function fetchStatus() {
            const res = await fetch(`/api/get?user_id=${user_id}`);
            const data = await res.json();
            document.getElementById('score').innerText = `–í–∞—à —Å—á–µ—Ç: ${data.score}`;
            document.getElementById('autoClickCount').innerText = data.upgrades?.auto_click || 0;
            document.getElementById('multiplierCount').innerText = data.upgrades?.multiplier || 0;
            document.getElementById('boostCount').innerText = data.upgrades?.boost || 0;
            let mult = 1 + (data.upgrades?.multiplier || 0);
            let info = `–ú–Ω–æ–∂–∏—Ç–µ–ª—å: x${mult}`;
            if (data.boost_until && data.boost_until > Date.now()/1000) {
                mult *= 3;
                let left = Math.floor(data.boost_until - Date.now()/1000);
                info += ` | –ë—É—Å—Ç –∞–∫—Ç–∏–≤–µ–Ω: x3 (${left} —Å–µ–∫.)`;
                document.getElementById('boostBar').style.display = '';
                let percent = Math.max(0, Math.min(100, 100 * left / 120));
                document.getElementById('boostBarInner').style.width = percent + '%';
            } else {
                document.getElementById('boostBar').style.display = 'none';
            }
            // –ü—Ä–æ–≥—Ä–µ—Å—Å –¥–æ —Å—É–Ω–¥—É–∫–∞
            let clicks = data.clicks || 0;
            let toChest = 50 - (clicks % 50);
            info += ` | –î–æ —Å—É–Ω–¥—É–∫–∞: ${toChest}`;
            // –°—É–Ω–¥—É–∫
            document.getElementById('chestBtn').style.display = data.chest_ready ? '' : 'none';
            // –ê—á–∏–≤–∫–∏
            let achs = data.achievements || [];
            let achHtml = '';
            if (achs.includes('100_clicks')) achHtml += '<span class="ach">üíØ 100 –∫–ª–∏–∫–æ–≤</span>';
            if (achs.includes('10_mult')) achHtml += '<span class="ach">üîü 10 –º–Ω–æ–∂–∏—Ç–µ–ª–µ–π</span>';
            document.getElementById('achievements').innerHTML = achHtml;
            // –¢–µ–º—ã
            fetchThemes(data.theme);
            lastScore = data.score;
        }
        document.getElementById('clickBtn').onclick = async () => {
            let btn = document.getElementById('clickBtn');
            btn.classList.add('pulse');
            setTimeout(()=>btn.classList.remove('pulse'), 300);
            const res = await fetch(`/api/click?user_id=${user_id}`, {method: 'POST'});
            const data = await res.json();
            fetchStatus();
            if (data.is_crit) {
                btn.classList.add('crit');
                showConfetti();
                setTimeout(()=>btn.classList.remove('crit'), 400);
            }
            if (data.chest) {
                document.getElementById('chestBtn').style.display = '';
            }
            if (data.new_ach) {
                showConfetti();
            }
        };
        document.getElementById('autoClickBtn').onclick = async () => {
            await fetch(`/api/upgrade?user_id=${user_id}&type=auto_click`, {method: 'POST'});
            fetchStatus();
            showConfetti();
        };
        document.getElementById('multiplierBtn').onclick = async () => {
            await fetch(`/api/upgrade?user_id=${user_id}&type=multiplier`, {method: 'POST'});
            fetchStatus();
            showConfetti();
        };
        document.getElementById('boostBtn').onclick = async () => {
            await fetch(`/api/upgrade?user_id=${user_id}&type=boost`, {method: 'POST'});
            fetchStatus();
            showConfetti();
        };
        document.getElementById('chestBtn').onclick = async () => {
            const res = await fetch(`/api/chest?user_id=${user_id}`, {method: 'POST'});
            const data = await res.json();
            alert(data.msg);
            fetchStatus();
            showConfetti();
        };
        document.getElementById('dailyBtn').onclick = async () => {
            const res = await fetch(`/api/daily?user_id=${user_id}`, {method: 'POST'});
            const data = await res.json();
            alert(data.msg);
            fetchStatus();
            showConfetti();
        };
        async function fetchThemes(current) {
            const res = await fetch('/api/themes');
            const data = await res.json();
            let html = '';
            for (let t of data.themes) {
                html += `<button class="theme-btn${current===t?' selected':''}" onclick="setTheme('${t}')">${t}</button>`;
            }
            document.getElementById('themeBtns').innerHTML = html;
        }
        window.setTheme = async function(theme) {
            await fetch(`/api/theme?user_id=${user_id}&theme=${theme}`, {method: 'POST'});
            if (theme==='default') document.body.style.setProperty('--bg', 'linear-gradient(135deg, #232526 0%, #414345 100%)');
            if (theme==='dark') document.body.style.setProperty('--bg', 'linear-gradient(135deg, #141e30 0%, #243b55 100%)');
            if (theme==='neon') document.body.style.setProperty('--bg', 'linear-gradient(135deg, #00c3ff 0%, #ffff1c 100%)');
            if (theme==='sunset') document.body.style.setProperty('--bg', 'linear-gradient(135deg, #ff512f 0%, #dd2476 100%)');
            fetchStatus();
        }
        // –ö–æ–Ω—Ñ–µ—Ç—Ç–∏
        function showConfetti() {
            let canvas = document.getElementById('confetti');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            canvas.style.display = '';
            let ctx = canvas.getContext('2d');
            let pieces = [];
            for (let i=0; i<80; ++i) {
                pieces.push({
                    x: Math.random()*canvas.width,
                    y: Math.random()*canvas.height/2,
                    r: 6+Math.random()*8,
                    c: `hsl(${Math.random()*360},100%,60%)`,
                    v: 2+Math.random()*4
                });
            }
            let t=0;
            function draw() {
                ctx.clearRect(0,0,canvas.width,canvas.height);
                for (let p of pieces) {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.r, 0, 2*Math.PI);
                    ctx.fillStyle = p.c;
                    ctx.fill();
                    p.y += p.v;
                    if (p.y > canvas.height) p.y = -10;
                }
                t++;
                if (t<40) requestAnimationFrame(draw);
                else canvas.style.display = 'none';
            }
            draw();
        }
        fetchStatus();
        setInterval(fetchStatus, 2000);
    </script>
</body>
</html> 